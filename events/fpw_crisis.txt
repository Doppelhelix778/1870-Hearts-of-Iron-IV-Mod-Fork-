add_namespace = fpw_crisis

# crisis triggered
country_event = {
	id = fpw_crisis.1
	title = fpw_crisis.1.t
	desc = fpw_crisis.1.d
	picture = GFX_report_event_romania_parliament

	is_triggered_only = yes

	# Do something
	option = {
		name = fpw_crisis.1.a 
		ai_chance = {
			base = 50 
		}
		trigger = {
			NOT = {
				any_country = {
					check_variable = { has_added_tension_amount > 50 }
					PREV = {
						is_in_faction_with = PREV
					}
				}
			}
		}
		set_country_flag = crisis_chosen_side
		if = {
			limit = {
				any_country = {
					is_in_array = {
						array = global.gw_initiator_array
						value = THIS
					}
				}
			}
			add_to_array = { global.gw_initiator_supporters_array = THIS }

			random_country = {
				limit = {
					is_in_array = {
						array = global.gw_initiator_array
						value = THIS
					}
				}
				country_event = fpw_crisis.2 
			}
		} else = {
			random_country = {
				limit = {
					AND = {
						is_in_array = {
							array = global.top_seven_prestige_array
							value = THIS
						}
						check_variable = { has_added_tension_amount > 50 }
						#check_variable = { has_added_tension_amount > 49 }
						#threat > 0.5
					}
				}
				add_to_array = { global.gw_target_array = THIS }
				country_event = fpw_crisis.3 
				if = {
					limit = {
						is_in_faction = yes
						is_faction_leader = yes
					}
					set_faction_name = "[THIS.GetAdjectiveCap]-Defensive Alliance"
				}
				else = {
					if = {
						limit = { 
							is_in_faction = yes
							is_faction_leader = no
						}
						leave_faction = yes
						create_faction = "[THIS.GetAdjectiveCap]-Defensive Alliance"
					}
					else = {
						create_faction = "[THIS.GetAdjectiveCap]-Defensive Alliance"
					}
				}
			}
			add_to_array = { global.gw_initiator_array = THIS }
			set_global_flag = fpw_great_war
			if = {
				limit = {
					is_in_faction = yes
					is_faction_leader = yes
				}
				set_faction_name = "Anti-xyx Alliance"
			}
			else = {
				if = {
					limit = { 
						is_in_faction = yes
						is_faction_leader = no
					}
					leave_faction = yes
					create_faction = "Anti-xyx Alliance"
				}
				else = {
					create_faction = "Anti-xyx Alliance"
				}
			}
			every_country = {
				limit = {
					is_in_array = {
						array = global.top_seven_prestige_array
						value = THIS
					}
					NOT = {
						# threat > 0.5, thus being the targetted country
						# not threat, it is has_added_tension_amount variable
						# in faction with target
						has_country_flag = fpw_crisis_triggered
						check_variable = { has_added_tension_amount > 50 }
					}
				}		
				set_country_flag = fpw_crisis_triggered
				# newspaper flavor event for the ai, i know sounds weird but to inform the player and the ai the newspaper will say something like "xy has started an international crisis against xy and parliaments all over the world are currently
				# scripted loc for multiplayer, if there is a initiator already the loc will say to join them, player gets immediet event stating what happened cause not bothered complicating this
				country_event = { id = fpw_crisis.1 days = 1 random_days = 3 } 
			}
		}
	}

	# Join target side
	option = {
		name = fpw_crisis.1.b
		ai_chance = {
			base = 25 
		}
		trigger = {
			# When theres an initiator, theres and target that you can support
			any_country = {
				is_in_array = {
					array = global.gw_initiator_array
					value = THIS
				}
			}
		}
		set_country_flag = crisis_chosen_side
		add_to_array = { global.gw_target_supporters_array = THIS }

		random_country = {
			limit = {
				is_in_array = {
					array = global.gw_target_array
					value = THIS
				}
			}
			country_event = fpw_crisis.2 
		}
	}

	# Do nothing
	option = {
		name = fpw_crisis.1.c
		ai_chance = {
			base = 0 
		}
		set_country_flag = crisis_chosen_side
		if = {
			limit = {
				NOT = {
					any_country = {
						is_in_array = {
							array = global.gw_initiator_array
							value = THIS
						}
					}
				}
			}
			random_country = {
				limit = {
					is_in_array = {
						array = global.top_seven_prestige_array
						value = THIS
					}
					NOT = {
						# threat > 0.5, thus being the targetted country
						# not threat, it is has_added_tension_amount variable
						# in faction with target
						has_country_flag = fpw_crisis_triggered
						check_variable = { has_added_tension_amount > 50 }
						
						# Countries in faction with the target wont get the event as they should support the target
						# Those will not be dragged into the supporter side to not make player have to be in a great war if they arent the target
						any_country = {
							# Target
							# For my future self, we just need to check for the threat as we are already scoped into the array
							check_variable = { has_added_tension_amount > 50 }
							PREV = {
								is_in_faction_with = PREV
							}
						}
					}
				}
				set_country_flag = fpw_crisis_triggered
				country_event = fpw_crisis.1
			}
		}
	}
}

# xy joins your support
country_event = {
	id = fpw_crisis.2
	title = fpw_crisis.2.t
	desc = fpw_crisis.2.d
	picture = GFX_report_event_chinese_japanese_handshake

	is_triggered_only = yes

	# Great
	option = {
		name = fpw_crisis.2.a 
		# FROM has decided to support you in the ongoing international crisis between you and initiator.GetNameDefCap
	}
}

# xy starts an crisis against you
country_event = {
	id = fpw_crisis.3
	title = fpw_crisis.3.t
	desc = fpw_crisis.3.d
	picture = GFX_report_event_generic_defensive_preparations

	is_triggered_only = yes

	# We will fight to the death
	option = {
		name = fpw_crisis.3.a 
	}
}

