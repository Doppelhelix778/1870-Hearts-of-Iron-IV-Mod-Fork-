scripted_gui = {
    colonize_button = {
        window_name = "province_colonize_window"
        parent_window_token = selected_state_view
        context_type = selected_state_context

        visible = {
            always = yes
        }

        triggers = {
            colonize_button_visible = {
                has_state_flag = tribe_state
                is_owned_by = TRB
				NOT = {
				state = 537
				}
                OR = {
                    is_coastal = yes
                    num_owned_neighbour_states = {
                        owner = ROOT
                        count > 0
                    }
                }
            }
            integrate_button_visible = {
                is_controlled_by = ROOT
                has_state_flag = can_be_integrated
            }
        }

        effects = {
            integrate_button_click = {
                clr_state_flag = is_colonized_by_@ROOT
                add_claim_by = ROOT 

                add_to_variable = { ROOT.debuff = THIS.admin_cost }
                
                if = {
                    limit = {
                        check_variable = { ROOT.debuff > 0 }
                    }
                    clamp_variable = {
                        var = ROOT.debuff
                        max = 0
                    }
                    ROOT = { remove_dynamic_modifier = { modifier = fpw_colonial_debuff } }
                } else = { ROOT = { force_update_dynamic_modifier = yes } }
            }

            colonize_button_click = {
                # check if can be colonized
                if = {
        			limit = {
                        ROOT = {
                            check_variable = {
                                THIS.colonists > 0
                            }
                        }
                        has_state_flag = tribe_state
                        NOT = {
                            has_state_flag = is_colonized
                        }
        				OR = {
                            AND = {
                                is_coastal = no
                                num_owned_neighbour_states = {
                                    owner = ROOT
                                    count > 0
                                }
                            }
                            AND = {
                                is_coastal = yes
                                if = {
                                    limit = {
                                        is_owned_by = ROOT
                                    }
                                    distance_to = {
                                        value < 75
                                        target = PREV
                                    }
                                }
                            }
        				}
        			}
                    colonize_state = yes
        		}
                else_if = {
                    limit = {
                        has_state_flag = is_colonized
                        has_state_flag = is_colonized_by_@ROOT
                    }
                    ROOT = {
                        remove_targeted_decision = {
                            target = PREV
                            decision = colonization_descision
                        }
                        clr_country_flag = is_colonizing
					    add_to_variable = { THIS.colonists = 1 }
                    }
                }
            }
        }

        ai_enabled = {
            is_historical_focus_on = no
        }

        ai_weights = {
            colonize_button_click = {
                ai_will_do = {
                    factor = 0
                }
            }
        }

        ai_test_interval = 290  # The higher, the long it takes the ai to do actions
        ai_test_variance = 0.5
    }
}